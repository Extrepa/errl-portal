
# warp_tasks.yaml — Errl Studio Companion for Warp
# Generated: 2025-11-02 10:31:30
# Purpose: Drive Warp through the exact commands to complete Studio setup.
# Notes:
# - This is plain YAML and does not depend on a specific Warp plugin.
# - Each task includes 'run' commands and optional 'verify' checks.
# - Safe-mode (no service worker) to avoid dev crashes during HMR.

phases:
  - id: baseline
    title: Phase 0 — Baseline / Branch
    tasks:
      - id: ensure-branch
        desc: Create/switch to chore/studio-upgrade
        run:
          - git checkout chore/studio-upgrade || git checkout -b chore/studio-upgrade
        verify:
          - git branch --show-current
      - id: deps
        desc: Ensure core deps installed
        run:
          - npm i @monaco-editor/react monaco-editor lucide-react jszip fabric --save-exact
        verify:
          - node -e "require.resolve('@monaco-editor/react');require.resolve('fabric');console.log('deps-ok')"

  - id: core-services
    title: Phase 1 — Core Services (Blob + Bus + ZIP)
    tasks:
      - id: add-utils
        desc: Ensure asset store, bus, and zip bundler exist
        run:
          - mkdir -p src/utils
          - '[ -f src/utils/assetStore.js ] || echo "// assetStore placeholder" > src/utils/assetStore.js'
          - '[ -f src/utils/bus.js ] || echo "// bus placeholder" > src/utils/bus.js'
          - '[ -f src/utils/zipBundler.js ] || echo "// zipBundler placeholder" > src/utils/zipBundler.js'
        verify:
          - ls -la src/utils | grep -E "assetStore|bus|zipBundler"

  - id: code-uplift
    title: Phase 3 — Code Tab Uplift (already present in v3.4)
    tasks:
      - id: run-dev
        desc: Start dev server
        run:
          - npm run dev
        note: Visit http://localhost:5173/studio and verify editors/preview load.

  - id: photos-tab
    title: Phase 2 — Photos Tab (Safe Mode)
    tasks:
      - id: place-photos-file
        desc: Ensure PhotosTab.jsx exists (safe-mode version)
        run:
          - mkdir -p src/apps
          - '[ -f src/apps/PhotosTab.jsx ] || echo "// PhotosTab placeholder" > src/apps/PhotosTab.jsx'
        verify:
          - ls -la src/apps | grep PhotosTab.jsx
      - id: mount-photos
        desc: Mount Photos tab inside ErrlLiveStudioPro Tabs
        run:
          - echo "MANUAL STEP: Edit src/apps/ErrlLiveStudioPro.jsx and add the lazy import, TabsTrigger, and TabsContent for Photos."
        verify:
          - echo "Open /studio → Tabs should show 'Photos' and load after click."

  - id: cloud-sync
    title: Phase 4 — Cloud Sync (Demo Server)
    tasks:
      - id: add-server
        desc: Add upload server (Express+Multer+CORS)
        run:
          - mkdir -p server
          - '[ -f server/upload.js ] || echo "// upload server placeholder" > server/upload.js'
          - npm i express multer cors --save-dev
        verify:
          - node -e "require.resolve('express');require.resolve('multer');require.resolve('cors');console.log('server-deps-ok')"
      - id: run-server
        desc: Run demo server
        run:
          - node server/upload.js
        note: In browser console on /studio, set window.ERRL_CLOUD_ENDPOINT = "http://localhost:5656/upload"

  - id: performance-devops
    title: Phase 5 & 6 — Performance + DevOps (Safe Mode)
    tasks:
      - id: no-sw
        desc: Ensure no service worker is registered in dev
        run:
          - echo "MANUAL STEP: Do NOT register a service worker during dev to avoid Warp tab crashes."
      - id: commit
        desc: Commit all changes
        run:
          - git add -A
          - git commit -m "chore(studio): baseline utils, photos tab mount, cloud demo (safe-mode)"
        verify:
          - git log -1 --oneline

checks:
  - id: assets-indexeddb
    desc: Validate assets are stored as blobs in IndexedDB
    steps:
      - "Open DevTools → Application → IndexedDB → errl-studio → meta/files exist"
  - id: zip-export
    desc: Validate Export ZIP includes assets
    steps:
      - "Click Export ZIP; inspect assets.manifest.json and /assets folder inside the ZIP"
  - id: photos-export
    desc: Validate Photos tab export
    steps:
      - "Place image from library, duplicate, center, export PNG/JPEG"

next:
  - "Canvas-merge Kit for original canvas page (blob+DND+ZIP)"
  - "Photos v1.1 (Layers panel, Align/Distribute, Crop, Text styling)"
  - "Supabase/S3 cloud adapter with signed URLs"
  - "ZIP import (drag-and-hydrate project)"
