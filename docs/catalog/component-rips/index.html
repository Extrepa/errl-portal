<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Component Rips Catalog</title>
    <style>
      :root {
        color-scheme: dark;
        --bg: #0d1018;
        --panel: #151b27;
        --border: #1f2735;
        --accent: #5ac0ff;
        --text: #f0f4ff;
        --muted: #9ca6bc;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background: radial-gradient(circle at top, #10192b, #07090d 65%);
        color: var(--text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      header {
        padding: 28px clamp(24px, 6vw, 64px) 12px;
      }
      header h1 {
        margin: 0 0 12px;
        font-size: clamp(28px, 5vw, 44px);
      }
      header p {
        margin: 4px 0;
        color: var(--muted);
        max-width: 720px;
      }
      main {
        flex: 1;
        padding: 0 clamp(24px, 6vw, 64px) 64px;
        display: flex;
        flex-direction: column;
        gap: 28px;
      }
      .filter-bar {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        background: rgba(14, 20, 32, 0.7);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 16px 18px;
      }
      .filter-bar select {
        background: rgba(8, 12, 22, 0.9);
        border: 1px solid rgba(90, 192, 255, 0.25);
        border-radius: 999px;
        color: var(--text);
        padding: 8px 14px;
        font-size: 14px;
      }
      .grid {
        display: grid;
        gap: 24px;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      }
      .card {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 22px;
        display: grid;
        gap: 16px;
        box-shadow: 0 24px 56px -32px rgba(6, 12, 32, 0.75);
        position: relative;
        transition: border-color 0.2s ease, transform 0.2s ease;
      }
      .card.copied::after {
        content: "Copied!";
        position: absolute;
        top: 12px;
        right: 18px;
        font-size: 12px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--accent);
      }
      .card:hover {
        border-color: rgba(90, 192, 255, 0.45);
        transform: translateY(-2px);
      }
      .card header .title {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
      }
      .card header h2 {
        margin: 0;
        font-size: 20px;
      }
      .card .category {
        margin: 0;
        color: rgba(155, 174, 210, 0.85);
        text-transform: uppercase;
        letter-spacing: 0.12em;
        font-size: 11px;
      }
      .status {
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid rgba(90, 192, 255, 0.3);
        color: var(--accent);
        font-size: 12px;
        font-weight: 600;
      }
      .status-normalized {
        background: rgba(106, 255, 205, 0.15);
        border-color: rgba(106, 255, 205, 0.4);
        color: #6affcd;
      }
      .status-gate {
        background: rgba(255, 170, 87, 0.18);
        border-color: rgba(255, 170, 87, 0.4);
        color: #ffbb73;
      }
      .status-queued {
        background: rgba(90, 192, 255, 0.18);
      }
      .status-scaffold {
        background: rgba(180, 160, 255, 0.18);
      }
      .status-raw {
        background: rgba(120, 140, 180, 0.18);
      }
      .status-demo-ready {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.35);
        color: #ffffff;
      }
      .status-integrated {
        background: rgba(110, 255, 170, 0.2);
        border-color: rgba(110, 255, 170, 0.5);
        color: #0f2618;
      }
      .description {
        margin: 0;
        color: var(--muted);
        line-height: 1.5;
        font-size: 14px;
      }
      .meta {
        display: grid;
        gap: 12px;
        font-size: 12px;
      }
      .meta .label {
        display: block;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-size: 11px;
        color: rgba(157, 176, 211, 0.7);
        margin-bottom: 4px;
      }
      .meta code {
        display: inline-block;
        background: rgba(10, 16, 28, 0.9);
        border-radius: 8px;
        padding: 4px 8px;
        border: 1px solid rgba(90, 192, 255, 0.16);
      }
      .controls {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-wrap: wrap;
        gap: 6px 8px;
      }
      .controls li {
        background: rgba(8, 12, 22, 0.7);
        border-radius: 8px;
        border: 1px solid rgba(90, 192, 255, 0.18);
        padding: 4px 8px;
      }
      .safety {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .safety li {
        background: rgba(28, 34, 48, 0.7);
        border-radius: 8px;
        border: 1px solid rgba(120, 160, 220, 0.18);
        padding: 4px 8px;
        font-size: 12px;
        color: rgba(200, 210, 240, 0.85);
      }
      .actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }
      .actions a,
      .actions button {
        border-radius: 999px;
        padding: 8px 16px;
        font-size: 13px;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
        border: 1px solid rgba(90, 192, 255, 0.25);
        background: rgba(10, 16, 28, 0.8);
        color: var(--text);
      }
      .actions a {
        background: linear-gradient(135deg, rgba(90, 192, 255, 0.35), rgba(106, 255, 205, 0.45));
        color: #041022;
      }
      .actions button:hover {
        border-color: rgba(90, 192, 255, 0.5);
      }
      .empty,
      .error {
        margin: 0;
        padding: 32px;
        text-align: center;
        border: 1px dashed rgba(90, 192, 255, 0.25);
        border-radius: 18px;
        color: rgba(200, 212, 240, 0.8);
        background: rgba(11, 16, 28, 0.6);
      }
      footer {
        padding: 24px clamp(24px, 6vw, 64px);
        color: var(--muted);
        font-size: 13px;
      }
      .placeholder {
        text-transform: uppercase;
        letter-spacing: 0.14em;
        font-size: 11px;
        color: rgba(154, 176, 210, 0.6);
      }
      @media (max-width: 720px) {
        main {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Component Rips Catalog</h1>
      <p>
        Live manifest of assets sourced from <code>archive/component-rips-20251112/Component_Rips</code>. Entries update when
        `packages/component-rips/*/meta.json` changes. Use filters to focus by category or status.
      </p>
    </header>
    <main id="catalog" aria-live="polite"></main>
    <footer>
      Status legend: raw → untouched export · queued → assigned for conversion · scaffold → bundle seeded · gate → requires
      safety controls · normalized → project-ready · demo-ready → catalog embed wired · integrated → live in portal/studio.
    </footer>
    <script type="module">
      const catalogEl = document.getElementById("catalog");
      const manifestUrl = new URL("./manifest.json", window.location.href);

      const statusPriority = ["integrated", "demo-ready", "normalized", "gate", "scaffold", "queued", "raw"];
      const statusLabels = {
        raw: "Raw",
        queued: "Queued",
        scaffold: "Scaffold",
        gate: "Gate",
        normalized: "Normalized",
        "demo-ready": "Demo Ready",
        integrated: "Integrated",
      };

      function createFilterBar(categories) {
        const wrapper = document.createElement("div");
        wrapper.className = "filter-bar";

        const categorySelect = document.createElement("select");
        categorySelect.innerHTML = `<option value="">All Categories</option>`;
        Object.keys(categories)
          .sort()
          .forEach((category) => {
            const option = document.createElement("option");
            option.value = category;
            option.textContent = category.charAt(0).toUpperCase() + category.slice(1);
            categorySelect.appendChild(option);
          });

        const statusSelect = document.createElement("select");
        statusSelect.innerHTML = `<option value="">All Statuses</option>`;
        statusPriority.forEach((status) => {
          const option = document.createElement("option");
          option.value = status;
          option.textContent = statusLabels[status] ?? status;
          statusSelect.appendChild(option);
        });

        wrapper.append(categorySelect, statusSelect);
        return { wrapper, categorySelect, statusSelect };
      }

      function renderCards(packages, filters) {
        const container = document.createElement("div");
        container.className = "grid";

        packages.forEach((pkg) => {
          if (filters.category && pkg.category !== filters.category) return;
          if (filters.status && pkg.status !== filters.status) return;

          const card = document.createElement("article");
          card.className = "card";

          const safety = pkg.safety ?? {};
          const safetySummaries = [
            `Audio: ${safety.audio ? "opt-in" : "none"}`,
            `Video: ${safety.video ? "opt-in" : "none"}`,
            `Camera: ${safety.camera ? "opt-in" : "none"}`,
          ];
          if (safety.notes) safetySummaries.push(safety.notes);

          card.innerHTML = `
            <header>
              <div class="title">
                <h2>${pkg.name}</h2>
                <span class="status status-${pkg.status}">${statusLabels[pkg.status] ?? pkg.status}</span>
              </div>
              <p class="category">${pkg.category}</p>
            </header>
            <p class="description">${pkg.description}</p>
            <div class="meta">
              <div>
                <span class="label">Source</span>
                <code>${pkg.source}</code>
              </div>
              <div>
                <span class="label">Controls</span>
                <ul class="controls">
                  ${
                    (pkg.controls ?? [])
                      .map((control) => {
                        const options = Array.isArray(control.options) ? ` — ${control.options.join(", ")}` : "";
                        return `<li><code>${control.label ?? control.id}</code>${control.type ? ` · ${control.type}` : ""}${options}</li>`;
                      })
                      .join("") || "<li>None</li>"
                  }
                </ul>
              </div>
              <div>
                <span class="label">Safety</span>
                <ul class="safety">
                  ${safetySummaries.map((line) => `<li>${line}</li>`).join("")}
                </ul>
              </div>
            </div>
            <div class="actions">
              <a href="${pkg.preview.index}" target="_blank" rel="noopener">Open Demo</a>
              <button data-copy="${pkg.slug}">Copy Import Path</button>
            </div>
          `;

          card.querySelector("button[data-copy]").addEventListener("click", async () => {
            const text = pkg.preview.index;
            if (navigator.clipboard?.writeText) {
              await navigator.clipboard.writeText(text);
            } else {
              const temp = document.createElement("textarea");
              temp.value = text;
              temp.setAttribute("readonly", "");
              temp.style.position = "absolute";
              temp.style.left = "-9999px";
              document.body.appendChild(temp);
              temp.select();
              document.execCommand("copy");
              document.body.removeChild(temp);
            }
            card.classList.add("copied");
            setTimeout(() => card.classList.remove("copied"), 900);
          });

          container.appendChild(card);
        });

        if (!container.childElementCount) {
          const empty = document.createElement("p");
          empty.className = "empty";
          empty.textContent = "No components match the current filters.";
          return empty;
        }

        return container;
      }

      function loadManifest(url) {
        return new Promise((resolve, reject) => {
          // Try fetch first (works with http/https)
          if (window.location.protocol === "http:" || window.location.protocol === "https:") {
            fetch(url, { cache: "no-store" })
              .then((response) => {
                if (!response.ok) throw new Error(`${response.status} ${response.statusText}`);
                return response.json();
              })
              .then(resolve)
              .catch(reject);
          } else {
            // Fallback to XMLHttpRequest for file:// protocol
            const xhr = new XMLHttpRequest();
            xhr.open("GET", url, true);
            xhr.onload = () => {
              if (xhr.status === 0 || xhr.status === 200) {
                try {
                  resolve(JSON.parse(xhr.responseText));
                } catch (e) {
                  reject(new Error(`Failed to parse manifest: ${e.message}`));
                }
              } else {
                reject(new Error(`HTTP ${xhr.status}: ${xhr.statusText}`));
              }
            };
            xhr.onerror = () => {
              reject(new Error(`Cannot load manifest from file:// protocol. Please use a local server:<br><br><code>cd docs/catalog/component-rips && python3 -m http.server 8000</code><br><br>Then open <code>http://localhost:8000</code> in your browser.`));
            };
            xhr.send();
          }
        });
      }

      async function bootstrap() {
        catalogEl.textContent = "Loading manifest…";
        try {
          const manifest = await loadManifest(manifestUrl);

          catalogEl.textContent = "";
          const { wrapper, categorySelect, statusSelect } = createFilterBar(manifest.categories);
          catalogEl.appendChild(wrapper);

          const render = () => {
            catalogEl.querySelectorAll(".grid, .empty").forEach((el) => el.remove());
            const filters = { category: categorySelect.value, status: statusSelect.value };
            const cards = renderCards(manifest.packages, filters);
            catalogEl.appendChild(cards);
          };

          categorySelect.addEventListener("change", render);
          statusSelect.addEventListener("change", render);
          render();
        } catch (error) {
          catalogEl.innerHTML = `<div class="error"><p>Failed to load manifest:</p><p>${error.message}</p></div>`;
        }
      }

      bootstrap();
    </script>
  </body>
</html>

