# Safari Layers Audit — Results Log

> Created: 2025-11-09  
> Context: `perf/layer-audit-portal-landing-2025-11-09`

Use this file to capture every measurement pass (Safari layers panel, graphics memory, compositing reasons, FPS notes, screenshots placed in `docs/perf/2025-11-09-safari-layers/`).

## Baseline Template

- Date / build:
- Safari version / hardware:
- Layer count:
- Graphics memory:
- Compositing hot spots:
- Notes & screenshots:

---

Append new sections as work progresses; keep chronological order.

## Baseline — 2025-11-09

- Date / build: 2025-11-09 / `de9819b`
- Safari version / hardware: Safari (DevTools audit export `Audit.audit` on local Mac — version not recorded)
- Layer count: 27 (per Layers panel)
- Graphics memory: ≈ **5.1 GB** total (dominant layers at ~544 MB each ×7, plus several 100 MB range entries)
- Compositing hot spots:
  - Seven layers at **544.64 MB** each (likely repeated backing surfaces for the WebGL canvas / DOM blending)
  - Additional large surfaces at 495.62 MB, 117.97 MB, 104–105 MB, 91.64 MB, 88.16 MB, 87.58 MB, 80.04 MB, 78.88 MB
  - Highest paint count observed: 17 paints on a 4.66 MB surface; most heavy memory layers show 1–3 paints
- Notes & screenshots: `docs/perf/2025-11-09-safari-layers/Audit.audit`, `.../Demo Audit.audit`, and the PNG set `Screenshot 2025-11-09 at 02.05.48.png` → `Screenshot 2025-11-09 at 02.06.26.png`

Baseline takeaway: Safari is allocating multiple ~0.5 GB backing layers, pushing composite memory above 5 GB before any optimisations. This confirms the need to clamp DPR, remove duplicate overlays, and reduce full-bleed compositing surfaces.

## Stage Audit — 2025-11-09 (Plan Item 9)

- Current Pixi graph:
  - `app.stage`  
    - `ParticleContainer` (GL bubbles)  
    - `fxRoot` (`PIXI.Container`)  
      - `overlay` sprite (gradient render texture + `overlayFilter`)  
      - Errl sprite (primary goo filter)  
      - `orbContainer` (mirror of DOM nav orbs, optional hue filter)  
- No filters applied directly to `app.stage`; everything hangs off `fxRoot` or individual sprites (good—avoids stage-wide promotion).
- Potential hot spots:
  - `gradientTexture()` regenerates a full-size render texture on every resize; at 1920×1080 this creates another ~8 MB RGBA surface each time. Consider caching/rescaling or reusing a smaller gradient.
  - Seven ~544 MB backing layers in Safari likely correspond to repeated composited surfaces for the overlay + WebGL canvas + DOM stacking. Reducing DPR and ensuring only one overlay layer should cut these down.
- Follow-up actions (separate tasks):
  - Reuse a single overlay render texture or switch to CSS gradient where possible.
  - Ensure renderer DPR cap is applied before first render (work in progress under plan items 10–12).

