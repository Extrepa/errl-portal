<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Shape Madness — All Effects | Errl</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0c12;
      --ink: #eaf2ff;
      --mut: #8fa3bf;
      --accent: #56c2ff;
      --accent2: #b8ff3b;
      --card: #0f141d;
      --tab: #111826;
      --btn: #152033;
      --stage: #0b0f16;
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      background: var(--bg);
      color: var(--ink);
      font: 500 14px/1.5 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;
    }
    /* Portal header styles */
    .errl-header {
      position: sticky; top: 0; width: 100%;
      background:
        linear-gradient(135deg, rgba(220,220,240,0.95) 0%, rgba(180,180,200,0.9) 25%, rgba(160,160,180,0.9) 50%, rgba(180,180,200,0.9) 75%, rgba(220,220,240,0.95) 100%),
        linear-gradient(45deg, rgba(255,255,255,0.3) 0%, transparent 30%, transparent 70%, rgba(255,255,255,0.3) 100%);
      box-shadow: 0 8px 32px rgba(0,0,0,0.4), 0 1px 0 rgba(255,255,255,0.4) inset, 0 -1px 0 rgba(0,0,0,0.2) inset;
      border-bottom: 1px solid rgba(120,120,140,0.6);
      padding: 0.75rem 1rem; z-index: 999; letter-spacing: -0.03em;
    }
    .errl-header-content { display:flex; align-items:center; justify-content:space-between; max-width:1200px; margin:0 auto; }
    .errl-home-btn{ display:inline-flex; align-items:center; gap:.5rem; color:#fff; background: linear-gradient(135deg, #ff0080 0%, #8000ff 25%, #0080ff 50%, #00ff80 75%, #ff8000 100%); background-size:200% 200%; border:1px solid rgba(255,255,255,0.3); border-radius:999px; font-size:.8rem; font-weight:600; line-height:1; padding:.55rem .9rem .6rem; box-shadow:0 4px 12px rgba(0,0,0,0.3), 0 1px 0 rgba(255,255,255,0.3) inset; text-decoration:none; text-shadow:0 1px 2px rgba(0,0,0,0.8); animation: rainbow-flow 3s linear infinite; }
    @keyframes rainbow-flow{ 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    @media (max-width: 640px){ .errl-home-btn{ width:38px; height:38px; padding:0; border-radius:999px; display:inline-grid; place-items:center; overflow:hidden; font-size:0; } .errl-home-btn::before{ content:'←'; font-size:16px; line-height:1; filter: drop-shadow(0 1px 2px rgba(0,0,0,.8)); } }
    .errl-nav{ display:flex; gap:.5rem; align-items:center; }
    .errl-bubble-btn{ position:relative; display:inline-flex; align-items:center; justify-content:center; min-width:6.5rem; max-width:10rem; padding:.6rem .9rem .7rem; border-radius:999px; font-size:.8rem; font-weight:600; line-height:1.1; text-align:center; color:#e8e8e8; text-decoration:none; white-space:nowrap; text-shadow:0 1px 3px rgba(0,0,0,0.8); background: linear-gradient(135deg, rgba(100,100,120,0.9) 0%, rgba(60,60,80,0.9) 25%, rgba(40,40,60,0.9) 50%, rgba(60,60,80,0.9) 75%, rgba(100,100,120,0.9) 100%), linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 30%, transparent 70%, rgba(255,255,255,0.1) 100%); border:2px solid transparent; background-clip:padding-box; box-shadow: 0 4px 12px rgba(0,0,0,0.3), 0 1px 0 rgba(255,255,255,0.2) inset, 0 -1px 0 rgba(0,0,0,0.3) inset; }
    .errl-bubble-btn::before{ content:""; position:absolute; inset:-2px; border-radius:999px; padding:2px; background: linear-gradient(90deg, rgba(0,255,255,0.6) 0%, rgba(255,0,255,0.6) 25%, rgba(255,255,0,0.6) 50%, rgba(0,255,0,0.6) 75%, rgba(0,255,255,0.6) 100%); background-size:200% 100%; mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); mask-composite:xor; -webkit-mask-composite:xor; animation: led-flow 2s linear infinite; opacity:.7; }
    @keyframes led-flow{ 0%{background-position:0% 50%} 100%{background-position:200% 50%} }
    .errl-bubble-btn.active{ background: linear-gradient(135deg, rgba(140,140,160,0.95) 0%, rgba(100,100,130,0.95) 25%, rgba(80,80,110,0.95) 50%, rgba(100,100,130,0.95) 75%, rgba(140,140,160,0.95) 100%), linear-gradient(45deg, rgba(255,255,255,0.2) 0%, transparent 30%, transparent 70%, rgba(255,255,255,0.2) 100%); color:#fff; font-weight:700; text-shadow:0 1px 3px rgba(0,0,0,0.9); box-shadow: 0 6px 16px rgba(0,0,0,0.4), 0 1px 0 rgba(255,255,255,0.3) inset, 0 -1px 0 rgba(0,0,0,0.4) inset; }
    .errl-bubble-btn.active::before{ background: radial-gradient(circle at 0% 50%, rgba(255,255,255,0.8) 0%, transparent 25%), radial-gradient(circle at 25% 50%, rgba(255,255,255,0.8) 0%, transparent 25%), radial-gradient(circle at 50% 50%, rgba(255,255,255,0.8) 0%, transparent 25%), radial-gradient(circle at 75% 50%, rgba(255,255,255,0.8) 0%, transparent 25%), radial-gradient(circle at 100% 50%, rgba(255,255,255,0.8) 0%, transparent 25%); background-size:20% 100%; animation: led-pulse 1s ease-in-out infinite alternate; opacity:.9; }
    @keyframes led-pulse{ 0%{opacity:.5} 100%{opacity:1} }
    
    /* Main content */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }
    .intro {
      text-align: center;
      padding: 3rem 1rem;
      margin-bottom: 2rem;
    }
    .intro h1 {
      font-size: clamp(2rem, 5vw, 4rem);
      margin: 0 0 1rem;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .intro p {
      color: var(--mut);
      font-size: 1.1rem;
      max-width: 600px;
      margin: 0 auto;
    }
    
    /* Flexible grid that adapts to window size - 2-3 columns */
    #sections-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(100%, 280px), 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    /* Ensure 2-3 columns based on available space */
    @media (min-width: 600px) {
      #sections-container {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      }
    }
    
    @media (min-width: 900px) {
      #sections-container {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        max-width: 100%;
      }
    }
    
    /* Section container - shape will be determined dynamically */
    .section {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.1);
      overflow: hidden;
      position: relative;
      display: flex;
      flex-direction: column;
      contain: layout style paint;
    }
    
    /* Shape variants */
    .section.shape-square {
      aspect-ratio: 1;
      border-radius: 12px;
    }
    
    .section.shape-circle {
      aspect-ratio: 1;
      border-radius: 50%;
    }
    
    .section.shape-landscape {
      aspect-ratio: 16/10;
      border-radius: 12px;
    }
    
    .section.shape-portrait {
      aspect-ratio: 10/16;
      border-radius: 12px;
    }
    
    .section.shape-wide {
      aspect-ratio: 21/9;
      border-radius: 12px;
    }
    
    .section.shape-tall {
      aspect-ratio: 9/16;
      border-radius: 12px;
    }
    .section-header {
      padding: 0.75rem;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }
    .section-header h2 {
      margin: 0;
      font-size: 0.85rem;
      color: var(--accent);
      font-weight: 600;
      line-height: 1.3;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      flex: 1;
      min-width: 0;
    }
    .section-actions {
      display: flex;
      gap: 0.25rem;
      flex-shrink: 0;
    }
    .section-btn {
      width: 24px;
      height: 24px;
      padding: 0;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.05);
      border-radius: 4px;
      cursor: pointer;
      display: grid;
      place-items: center;
      color: var(--mut);
      font-size: 12px;
      transition: all 0.2s;
    }
    .section-btn:hover {
      background: rgba(255,255,255,0.1);
      border-color: var(--accent);
      color: var(--accent);
    }
    .section-header p {
      display: none; /* Hide counter to save space */
    }
    
    /* Expand Modal */
    .expand-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      backdrop-filter: blur(8px);
    }
    .expand-modal.active {
      display: flex;
    }
    .expand-modal-content {
      position: relative;
      width: 100%;
      max-width: 90vw;
      max-height: 90vh;
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .expand-modal-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-shrink: 0;
    }
    .expand-modal-header h3 {
      margin: 0;
      font-size: 1.25rem;
      color: var(--accent);
    }
    .expand-modal-close {
      width: 32px;
      height: 32px;
      padding: 0;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      cursor: pointer;
      display: grid;
      place-items: center;
      color: var(--mut);
      font-size: 18px;
      transition: all 0.2s;
    }
    .expand-modal-close:hover {
      background: rgba(255,255,255,0.1);
      border-color: var(--accent);
      color: var(--accent);
    }
    .expand-modal-body {
      flex: 1;
      min-height: 0;
      position: relative;
      overflow: hidden;
    }
    .expand-modal-body iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }
    .section-content {
      position: relative;
      flex: 1;
      min-height: 0;
      overflow: hidden;
    }
    .section-content iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
      background: var(--stage);
      contain: layout style paint;
    }
    .loading-placeholder {
      display: grid;
      place-items: center;
      width: 100%;
      height: 100%;
      color: var(--mut);
      font-size: 0.75rem;
      background: var(--stage);
    }
    .spinner {
      width: 24px;
      height: 24px;
      border: 2px solid rgba(86,194,255,0.2);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.001ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.001ms !important;
      }
    }
  </style>
</head>
<body>
  <header class="errl-header">
    <div class="errl-header-content">
      <a class="errl-home-btn" href="../../index.html">← Back to Portal</a>
      <nav class="errl-nav">
        <a class="errl-bubble-btn" href="../../about/index.html">About Errl</a>
        <a class="errl-bubble-btn" href="../../gallery/index.html">Gallery</a>
        <a class="errl-bubble-btn" href="../../projects/index.html">Projects</a>
        <a class="errl-bubble-btn" href="../index.html">Studio</a>
        <a class="errl-bubble-btn" href="../../pin-designer/index.html">Pin Designer</a>
      </nav>
    </div>
  </header>
  
  <div class="container">
    <div class="intro">
      <h1>Shape Madness</h1>
      <p>A collection of experimental visual effects, shapes, and animations. Scroll to explore — each section loads as you view it. (Duplicates with Math Lab have been removed.)</p>
    </div>
    
    <div id="sections-container"></div>
  </div>
  
  <!-- Expand Modal -->
  <div class="expand-modal" id="expandModal">
    <div class="expand-modal-content">
      <div class="expand-modal-header">
        <h3 id="expandModalTitle">Effect Preview</h3>
        <button class="expand-modal-close" id="expandModalClose" aria-label="Close">×</button>
      </div>
      <div class="expand-modal-body">
        <iframe id="expandModalIframe"></iframe>
      </div>
    </div>
  </div>
  
  <script>
    // Load CSS examples manifest
    let cssExamples = [];
    fetch('./content/css-examples/manifest.json')
      .then(r => r.json())
      .then(data => {
        cssExamples = data.files.map(f => ({
          name: f.name,
          path: f.path,
          label: f.label,
          category: 'CSS Examples'
        }));
        initPage();
      })
      .catch(() => {
        // If manifest doesn't exist, continue without CSS examples
        initPage();
      });
    
    // List of all HTML files to include (sorted by path)
    // Duplicates removed: Temporal Kaleido Rings (similar to Kaleidoscope Shader in Math Lab),
    // Orbit Knots Canvas (similar to Spirograph Engines in Math Lab),
    // SVG Moiré Kaleido (errl 13.html, similar to Kaleidoscope/Moiré in Math Lab),
    // Offscreen Knots (errl 16.html, similar to Spirograph in Math Lab)
    const originalFiles = [
      { name: "Chroma Bloom Button", path: "chroma-bloom-button/errl.html", category: "Buttons" },
      { name: "Chroma Bloom Button (Minimal)", path: "chroma-bloom-button/minimal.html", category: "Buttons" },
      { name: "Chroma Bloom Button (Remix)", path: "chroma-bloom-button/remix.html", category: "Buttons" },
      { name: "Palette Morph Timeline", path: "errl.html", category: "Animations" },
      { name: "Curl Noise Rivers", path: "curl-noise-rivers/index.html", category: "Particles" },
      { name: "Effect 4", path: "errl 4.html", category: "Effects" },
      { name: "Effect 5", path: "errl 5.html", category: "Effects" },
      { name: "Effect 6", path: "errl 6.html", category: "Effects" },
      { name: "Effect 7", path: "errl 7.html", category: "Effects" },
      { name: "Effect 8", path: "errl 8.html", category: "Effects" },
      { name: "Effect 9", path: "errl 9.html", category: "Effects" },
      { name: "Effect 10", path: "errl 10.html", category: "Effects" },
      { name: "Audio-Reactive Errl Orb", path: "errl 11.html", category: "Audio" },
      { name: "Flow-Field Ribbons", path: "errl 12.html", category: "Particles" },
      { name: "Hyperspace Tunnel", path: "errl 14.html", category: "3D" },
      { name: "Beat-Reactive Spectrum", path: "errl 15.html", category: "Audio" },
      { name: "Iridescent Goo Card", path: "iridescent-goo-card/errl.html", category: "Cards" },
      { name: "Iridescent Goo Card (Minimal)", path: "iridescent-goo-card/minimal.html", category: "Cards" },
      { name: "Iridescent Goo Card (Remix)", path: "iridescent-goo-card/remix.html", category: "Cards" },
      { name: "Liquid Crystal Text", path: "liquid-crystal-text/errl.html", category: "Text" },
      { name: "Liquid Crystal Text (Minimal)", path: "liquid-crystal-text/minimal.html", category: "Text" },
      { name: "Liquid Crystal Text (Remix)", path: "liquid-crystal-text/remix.html", category: "Text" },
      { name: "Minimal", path: "minimal.html", category: "Effects" },
      { name: "Poincare Disk Arcs", path: "poincare-disk-arcs/index.html", category: "Geometry" },
      { name: "Quantum Slime Halo", path: "quantum-slime-halo/errl.html", category: "Halo" },
      { name: "Quantum Slime Halo (Minimal)", path: "quantum-slime-halo/minimal.html", category: "Halo" },
      { name: "Quantum Slime Halo (Remix)", path: "quantum-slime-halo/remix.html", category: "Halo" },
      { name: "Reaction Diffusion Lab", path: "reaction-diffusion/index.html", category: "Math Lab" },
      { name: "Remix", path: "remix.html", category: "Effects" },
      { name: "Remix 2", path: "remix2.html", category: "Effects" }
    ];
    
    let files = [];
    
    const container = document.getElementById('sections-container');
    const basePath = './content/';
    
    // Shape mapping based on file names/patterns (can be enhanced)
    const shapeMap = {
      'halo': 'circle',
      'orb': 'circle',
      'ring': 'circle',
      'button': 'square',
      'card': 'landscape',
      'tunnel': 'circle',
      'sheets': 'landscape',
      'avatar': 'circle',
      'spinner': 'circle',
      'heart': 'square',
      'blob': 'landscape',
      'grid': 'square',
      'progress': 'landscape',
      'badge': 'square',
      'toast': 'landscape',
      'modal': 'landscape',
      'tabs': 'landscape'
    };
    
    function createSections() {
      // Clear container
      container.innerHTML = '';
      
      // Create sections for each file
      files.forEach((file, index) => {
      const section = document.createElement('div');
      section.className = 'section';
      section.id = `section-${index}`;
      
      // Try to detect shape from filename
      const pathLower = file.path.toLowerCase();
      let defaultShape = 'landscape';
      for (const [key, shape] of Object.entries(shapeMap)) {
        if (pathLower.includes(key)) {
          defaultShape = shape;
          break;
        }
      }
      section.classList.add('shape-' + defaultShape);
      
      section.innerHTML = `
        <div class="section-header">
          <h2>${file.name}</h2>
          <div class="section-actions">
            <button class="section-btn" data-action="expand" data-index="${index}" title="Expand" aria-label="Expand">⛶</button>
            <button class="section-btn" data-action="download" data-index="${index}" title="Download" aria-label="Download">↓</button>
          </div>
        </div>
        <div class="section-content">
          <div class="loading-placeholder">
            <div class="spinner"></div>
          </div>
        </div>
      `;
        container.appendChild(section);
      });
      
      // Set up lazy loading observer after sections are created
      setupLazyLoading();
    }
    
    function initPage() {
      // Combine original files and CSS examples
      files = [...originalFiles, ...cssExamples];
      
      // Sort by category, then by name
      files.sort((a, b) => {
        if (a.category !== b.category) {
          return (a.category || '').localeCompare(b.category || '');
        }
        return a.name.localeCompare(b.name);
      });
      
      createSections();
    }
    
    // Expand and Download handlers
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.section-btn');
      if (!btn) return;
      
      const action = btn.dataset.action;
      const index = parseInt(btn.dataset.index);
      const file = files[index];
      
      if (action === 'expand') {
        expandEffect(file);
      } else if (action === 'download') {
        downloadEffect(file);
      }
    });
    
    // Expand modal
    const expandModal = document.getElementById('expandModal');
    const expandModalTitle = document.getElementById('expandModalTitle');
    const expandModalIframe = document.getElementById('expandModalIframe');
    const expandModalClose = document.getElementById('expandModalClose');
    
    function expandEffect(file) {
      expandModalTitle.textContent = file.name;
      expandModalIframe.src = basePath + file.path;
      expandModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    
    expandModalClose.addEventListener('click', () => {
      expandModal.classList.remove('active');
      expandModalIframe.src = '';
      document.body.style.overflow = '';
    });
    
    expandModal.addEventListener('click', (e) => {
      if (e.target === expandModal) {
        expandModalClose.click();
      }
    });
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && expandModal.classList.contains('active')) {
        expandModalClose.click();
      }
    });
    
    // Download functionality
    function downloadEffect(file) {
      const url = basePath + file.path;
      fetch(url)
        .then(r => r.text())
        .then(html => {
          const blob = new Blob([html], { type: 'text/html' });
          const downloadUrl = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = downloadUrl;
          a.download = file.path.split('/').pop() || 'effect.html';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(downloadUrl);
        })
        .catch(err => {
          console.error('Download failed:', err);
          alert('Download failed. Please try again.');
        });
    }
    
    // Intersection Observer for lazy loading
    let observer = null;
    
    function setupLazyLoading() {
      if (observer) {
        observer.disconnect();
      }
      
      const observerOptions = {
        root: null,
        rootMargin: '100px',
        threshold: 0.01
      };
      
      observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting && !entry.target.classList.contains('loaded')) {
            const section = entry.target;
            const index = parseInt(section.id.split('-')[1]);
            const file = files[index];
            
            // Load the content
            loadSection(section, file, index);
            observer.unobserve(section);
          }
        });
      }, observerOptions);
      
      // Observe all sections
      document.querySelectorAll('.section').forEach(section => {
        observer.observe(section);
      });
    }
    
    function detectShape(iframe, section) {
      return new Promise((resolve) => {
        const checkShape = () => {
          try {
            const doc = iframe.contentDocument || iframe.contentWindow.document;
            if (!doc || !doc.body) {
              setTimeout(checkShape, 50);
              return;
            }
            
            const body = doc.body;
            const html = doc.documentElement;
            
            // Get computed dimensions
            const width = Math.max(body.scrollWidth, body.offsetWidth, html.clientWidth, html.scrollWidth);
            const height = Math.max(body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight);
            
            if (width === 0 || height === 0) {
              setTimeout(checkShape, 50);
              return;
            }
            
            const ratio = width / height;
            let shape = 'landscape'; // default
            
            // Detect shape based on aspect ratio
            if (Math.abs(ratio - 1) < 0.15) {
              // Check if it's a circle (look for circular elements or border-radius: 50%)
              const hasCircle = doc.querySelector('[style*="border-radius:50%"], [style*="border-radius: 50%"], .halo, [class*="circle"], [class*="ring"], [class*="halo"]');
              shape = hasCircle ? 'circle' : 'square';
            } else if (ratio > 1.8) {
              shape = 'wide';
            } else if (ratio > 1.2) {
              shape = 'landscape';
            } else if (ratio < 0.6) {
              shape = 'tall';
            } else if (ratio < 0.9) {
              shape = 'portrait';
            }
            
            resolve(shape);
          } catch (e) {
            // Cross-origin or not ready, use existing class or default
            const existing = Array.from(section.classList).find(c => c.startsWith('shape-'));
            resolve(existing ? existing.replace('shape-', '') : 'landscape');
          }
        };
        
        // Start checking after a short delay
        setTimeout(checkShape, 200);
        // Fallback timeout
        setTimeout(() => {
          const existing = Array.from(section.classList).find(c => c.startsWith('shape-'));
          resolve(existing ? existing.replace('shape-', '') : 'landscape');
        }, 3000);
      });
    }
    
    function loadSection(section, file, index) {
      const contentDiv = section.querySelector('.section-content');
      const iframe = document.createElement('iframe');
      iframe.src = basePath + file.path;
      iframe.style.width = '100%';
      iframe.style.height = '100%';
      iframe.style.border = 'none';
      iframe.style.display = 'block';
      iframe.style.background = 'var(--stage)';
      iframe.loading = 'lazy';
      // Remove sandbox to allow shape detection (files are local)
      
      // Prevent flashing by setting opacity after load
      iframe.style.opacity = '0';
      iframe.style.transition = 'opacity 0.3s ease';
      
      iframe.onload = async () => {
        // Detect shape and update class if different
        try {
          const detectedShape = await detectShape(iframe, section);
          // Remove all shape classes
          section.classList.remove('shape-square', 'shape-circle', 'shape-landscape', 'shape-portrait', 'shape-wide', 'shape-tall');
          // Add detected shape
          section.classList.add('shape-' + detectedShape);
        } catch (e) {
          // Keep default shape
        }
        iframe.style.opacity = '1';
        section.classList.add('loaded');
      };
      
      iframe.onerror = () => {
        contentDiv.innerHTML = `
          <div class="loading-placeholder">
            <p>Error loading</p>
          </div>
        `;
        section.classList.add('loaded');
      };
      
      // Start loading
      contentDiv.innerHTML = '';
      contentDiv.appendChild(iframe);
    }
  </script>
</body>
</html>
