<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Art Gallery | Errl</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../../../shared/styles/errlDesignSystem.css" />
  <link rel="stylesheet" href="../../../../fx/errl-bg.css">
  <style>
    body { margin: 0; padding: 0; font-family: 'Inter', system-ui, sans-serif; background: var(--errl-bg); color: var(--errl-text); min-height: 100vh; }
    /* Header (shared) */
    .errl-header{ position:sticky; top:0; width:100%; background: linear-gradient(135deg, rgba(220,220,240,0.95) 0%, rgba(180,180,200,0.9) 25%, rgba(160,160,180,0.9) 50%, rgba(180,180,200,0.9) 75%, rgba(220,220,240,0.95) 100%), linear-gradient(45deg, rgba(255,255,255,0.3) 0%, transparent 30%, transparent 70%, rgba(255,255,255,0.3) 100%); box-shadow: 0 8px 32px rgba(0,0,0,0.4), 0 1px 0 rgba(255,255,255,0.4) inset, 0 -1px 0 rgba(0,0,0,0.2) inset; border-bottom:1px solid rgba(120,120,140,0.6); padding:0.75rem 1rem; z-index:999; letter-spacing:-0.03em; }
    .errl-header-content{ display:flex; align-items:center; justify-content:space-between; max-width: 1200px; margin: 0 auto; }
    .errl-home-btn{ display:inline-flex; align-items:center; gap:.5rem; color:#fff; background: linear-gradient(135deg, #ff0080 0%, #8000ff 25%, #0080ff 50%, #00ff80 75%, #ff8000 100%); background-size:200% 200%; border:1px solid rgba(255,255,255,0.3); border-radius:999px; font-size:.8rem; font-weight:600; line-height:1; padding:.55rem .9rem .6rem; box-shadow:0 4px 12px rgba(0,0,0,0.3), 0 1px 0 rgba(255,255,255,0.3) inset; text-decoration:none; text-shadow:0 1px 2px rgba(0,0,0,0.8); animation: rainbow-flow 3s linear infinite; }
    @keyframes rainbow-flow{ 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    /* Back button: compact circle on small screens */
    @media (max-width: 640px){
      .errl-home-btn{ width:38px; height:38px; padding:0; border-radius:999px; display:inline-grid; place-items:center; overflow:hidden; font-size:0; }
      .errl-home-btn::before{ content:'←'; font-size:16px; line-height:1; filter: drop-shadow(0 1px 2px rgba(0,0,0,.8)); }
    }
    .errl-nav{ display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; overflow-x:auto; scrollbar-width:none; -ms-overflow-style:none; }
    .errl-nav::-webkit-scrollbar{ display:none; }
    .errl-bubble-btn{ position:relative; display:inline-flex; align-items:center; justify-content:center; min-width:6.5rem; max-width:10rem; padding:.6rem .9rem .7rem; border-radius:999px; font-size:.8rem; font-weight:600; line-height:1.1; text-align:center; color:#e8e8e8; text-decoration:none; white-space:nowrap; text-shadow:0 1px 3px rgba(0,0,0,0.8); background: linear-gradient(135deg, rgba(100,100,120,0.9) 0%, rgba(60,60,80,0.9) 25%, rgba(40,40,60,0.9) 50%, rgba(60,60,80,0.9) 75%, rgba(100,100,120,0.9) 100%), linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 30%, transparent 70%, rgba(255,255,255,0.1) 100%); border:2px solid transparent; background-clip:padding-box; box-shadow: 0 4px 12px rgba(0,0,0,0.3), 0 1px 0 rgba(255,255,255,0.2) inset, 0 -1px 0 rgba(0,0,0,0.3) inset; flex-shrink:0; }
    @media (max-width: 900px){
      .errl-header-content{ flex-wrap:wrap; gap:.75rem; }
      .errl-nav{ gap:.4rem; max-width:100%; }
      .errl-bubble-btn{ min-width:5.5rem; max-width:8rem; padding:.5rem .75rem .6rem; font-size:.75rem; }
    }
    @media (max-width: 640px){
      .errl-nav{ gap:.3rem; }
      .errl-bubble-btn{ min-width:4.5rem; max-width:7rem; padding:.45rem .65rem .55rem; font-size:.7rem; }
    }
    .errl-bubble-btn::before{ content:""; position:absolute; inset:-2px; border-radius:999px; padding:2px; background: linear-gradient(90deg, rgba(0,255,255,0.6) 0%, rgba(255,0,255,0.6) 25%, rgba(255,255,0,0.6) 50%, rgba(0,255,0,0.6) 75%, rgba(0,255,255,0.6) 100%); background-size:200% 100%; mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); mask-composite:xor; -webkit-mask-composite:xor; animation: led-flow 2s linear infinite; opacity:.7; }
    @keyframes led-flow{ 0%{background-position:0% 50%} 100%{background-position:200% 50%} }
    .errl-bubble-btn.active{ background: linear-gradient(135deg, rgba(140,140,160,0.95) 0%, rgba(100,100,130,0.95) 25%, rgba(80,80,110,0.95) 50%, rgba(100,100,130,0.95) 75%, rgba(140,140,160,0.95) 100%), linear-gradient(45deg, rgba(255,255,255,0.2) 0%, transparent 30%, transparent 70%, rgba(255,255,255,0.2) 100%); color:#fff; font-weight:700; text-shadow:0 1px 3px rgba(0,0,0,0.9); box-shadow: 0 6px 16px rgba(0,0,0,0.4), 0 1px 0 rgba(255,255,255,0.3) inset, 0 -1px 0 rgba(0,0,0,0.4) inset; }
    .errl-bubble-btn.active::before{ background: radial-gradient(circle at 0% 50%, rgba(255,255,255,0.8) 0%, transparent 25%), radial-gradient(circle at 25% 50%, rgba(255,255,255,0.8) 0%, transparent 25%), radial-gradient(circle at 50% 50%, rgba(255,255,255,0.8) 0%, transparent 25%), radial-gradient(circle at 75% 50%, rgba(255,255,255,0.8) 0%, transparent 25%), radial-gradient(circle at 100% 50%, rgba(255,255,255,0.8) 0%, transparent 25%); background-size:20% 100%; animation: led-pulse 1s ease-in-out infinite alternate; opacity:.9; }
    @keyframes led-pulse{ 0%{opacity:.5} 100%{opacity:1} }

    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    h1 { font-size: 2.2rem; margin: 16px 0; text-align: center; opacity:.9; }
    .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin: 20px 0 40px; padding: 0 20px; }
    .gallery-item { background: rgba(var(--errl-text-rgb), 0.05); border: 1px solid rgba(var(--errl-text-rgb), 0.1); border-radius: 12px; overflow: hidden; transition: all 0.3s; }
    .gallery-item:hover { background: rgba(var(--errl-text-rgb), 0.08); transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3); }
    .gallery-item img { width: 100%; display: block; aspect-ratio: 1; object-fit: cover; }
    .gallery-item h3 { margin: 0; padding: 12px; font-size: 0.9rem; text-align: center; }
    .loading { text-align: center; padding: 60px 20px; opacity: 0.6; }
  </style>
</head>
<body>
  <header class="errl-header">
    <div class="errl-header-content">
<a class="errl-home-btn" href="/">← Back to Portal</a>
      <nav class="errl-nav">
        <a class="errl-bubble-btn" href="/about/" data-portal-link="about/">About Errl</a>
        <a class="errl-bubble-btn active" href="/gallery/" data-portal-link="gallery/">Gallery</a>
        <a class="errl-bubble-btn" href="/assets/" data-portal-link="assets/">Assets</a>
        <a class="errl-bubble-btn" href="/studio.html">Studio</a>
        <a class="errl-bubble-btn" href="#" data-multitool-link>Multitool</a>
        <a class="errl-bubble-btn" href="/events/" data-portal-link="events/">Events</a>
        <a class="errl-bubble-btn" href="/merch/" data-portal-link="merch/">Merch</a>
      </nav>
    </div>
  </header>
  <div class="container">
    <h1>Art Gallery</h1>
    <div id="gallery" class="gallery"><div class="loading">Loading gallery...</div></div>
  </div>

  <!-- Inline fallback manifest for file:// viewing -->
  <script id="manifestInline" type="application/json">
{
  "default": "recent",
  "albums": [
    {
      "id": "recent",
      "title": "Recent Generations",
      "cover": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_1.jpg",
      "items": [
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_1.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 1"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_2.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 2"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_3.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 3"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_4.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 4"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_5.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 5"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_6.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 6"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_7.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 7"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_8.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 8"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_9.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 9"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_10.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 10"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_11.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 11"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_12.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 12"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_13.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 13"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_14.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 14"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_15.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 15"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_16.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 16"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_17.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 17"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_18.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 18"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_19.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 19"
        },
        {
          "src": "%BASE_URL%assets/legacy/gallery/recent/Errl_OpenArt_2025Oct_JPEG_20.jpg",
          "title": "Errl OpenArt 2025Oct JPEG 20"
        }
        
      ]
    }
  ]
}
  </script>

  <script>
    (async function(){
      const gallery = document.getElementById('gallery');
      async function loadManifest(){
        if (location.protocol !== 'file:'){
          try {
            const res = await fetch('./manifest.json', { cache: 'no-store' });
            if (res.ok) return await res.json();
          } catch (e) { /* fall through */ }
        }
        const inline = document.getElementById('manifestInline');
        if (inline && inline.textContent) {
          try { return JSON.parse(inline.textContent); } catch {}
        }
        throw new Error('Manifest unavailable');
      }
      try {
        const data = await loadManifest();
        // Replace %BASE_URL% placeholder with actual base URL
        let baseUrl = '/';
        try {
          // Try Vite's import.meta.env first
          if (typeof import !== 'undefined' && import.meta?.env?.BASE_URL) {
            baseUrl = import.meta.env.BASE_URL;
          } else if (document.querySelector('base')?.getAttribute('href')) {
            baseUrl = document.querySelector('base').getAttribute('href');
          } else {
            // Fallback: use current location to determine base path
            const path = window.location.pathname;
            // Remove /gallery/ or /gallery/index.html from path
            const galleryMatch = path.match(/^(.+?)\/gallery/);
            if (galleryMatch) {
              baseUrl = galleryMatch[1] + '/';
            } else {
              // For /gallery/ or /gallery/index.html, go up one level
              const pathParts = path.split('/').filter(Boolean);
              if (pathParts[pathParts.length - 1] === 'gallery' || pathParts[pathParts.length - 1] === 'index.html') {
                pathParts.pop();
              }
              baseUrl = '/' + pathParts.join('/') + '/';
            }
            // Ensure baseUrl starts with /
            if (!baseUrl.startsWith('/')) baseUrl = '/' + baseUrl;
            // Ensure baseUrl ends with /
            if (!baseUrl.endsWith('/')) baseUrl = baseUrl + '/';
          }
        } catch (e) {
          console.warn('Base URL detection failed, using /:', e);
          baseUrl = '/';
        }
        const processManifest = (obj) => {
          if (typeof obj === 'string') {
            let processed = obj.replace(/%BASE_URL%/g, baseUrl);
            // Fix double slashes
            processed = processed.replace(/([^:]\/)\/+/g, '$1');
            return processed;
          }
          if (Array.isArray(obj)) {
            return obj.map(processManifest);
          }
          if (obj && typeof obj === 'object') {
            const processed = {};
            for (const [key, value] of Object.entries(obj)) {
              processed[key] = processManifest(value);
            }
            return processed;
          }
          return obj;
        };
        const processedData = processManifest(data);
        const album = processedData.albums?.[0];
        if (album && album.items && album.items.length > 0) {
          gallery.innerHTML = album.items.map(item => {
            const imgSrc = item.src || item.cover || '';
            const imgTitle = item.title || 'Untitled';
            return `
            <div class="gallery-item">
              <img src="${imgSrc}" alt="${imgTitle}" loading="lazy" onerror="this.style.display='none'; this.parentElement.querySelector('h3').textContent='Image failed to load';">
              <h3>${imgTitle}</h3>
            </div>
          `;
          }).join('');
        } else {
          gallery.innerHTML = '<div class="loading">No images found in manifest</div>';
        }
      } catch (err) {
        console.error('Gallery manifest load failed:', err);
        gallery.innerHTML = '<div class="loading">Error loading gallery: ' + err.message + '</div>';
      }
    })();

    // Resolve Multitool links - use localhost in dev, relative path in production
    document.querySelectorAll("[data-multitool-link]").forEach((el) => {
      const isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
      el.setAttribute("href", isDev ? "http://localhost:5174" : "/multitool/");
    });
  </script>
</body>
</html>
