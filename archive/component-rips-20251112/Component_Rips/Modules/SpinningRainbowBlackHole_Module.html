<!doctype html>
<html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Prism Refraction Map</title>
<style>
 html,body{height:100%;margin:0;background:#03030a;color:#fff;font-family:ui-sans-serif}
 canvas{position:fixed; inset:0}
 .ui{position:fixed; bottom:1rem; left:50%; transform:translateX(-50%); background:#0006; padding:.4rem .8rem; border:1px solid #fff2; border-radius:10px}
</style></head><body>
<canvas id="bg"></canvas>
<canvas id="fx"></canvas>
<div class="ui">Drag to move the prism; scroll to change strength.</div>
<script>
const bg=document.getElementById('bg'), fx=document.getElementById('fx'); const gb=bg.getContext('2d'), gf=fx.getContext('2d');
function fit(){[bg,fx].forEach(x=>{x.width=innerWidth; x.height=innerHeight});} fit(); addEventListener('resize',fit);
let mx=innerWidth/2,my=innerHeight/2, strength=10;
addEventListener('pointermove', e=>{mx=e.clientX; my=e.clientY;});
addEventListener('wheel', e=>{strength = Math.max(0, Math.min(40, strength + Math.sign(e.deltaY)));});

function drawBG(t){
  const cx=innerWidth/2, cy=innerHeight/2; gb.clearRect(0,0,bg.width,bg.height);
  for(let i=0;i<220;i++){
    const r = 40 + i*3, a = t/1400 + i*0.09;
    gb.strokeStyle = `hsla(${(i*2+t/20)%360},100%,50%,0.5)`;
    gb.beginPath(); gb.arc(cx + Math.cos(a)*20, cy + Math.sin(a)*20, r*0.35, 0, 6.283); gb.stroke();
  }
}
function drawRefraction(){
  // build a tiny height field (circular lens) and displace bg onto fx
  const w=fx.width, h=fx.height;
  const img = gb.getImageData(0,0,w,h);
  const out = gf.createImageData(w,h);
  const r=120;
  for(let y=-r; y<=r; y++){
    for(let x=-r; x<=r; x++){
      const dx=x, dy=y; const d2=dx*dx+dy*dy; if(d2>r*r) continue;
      const d = Math.sqrt(d2)/r; // 0..1
      const n = (1 - d*d); // lens profile
      const sx = Math.max(0, Math.min(w-1, Math.round(mx + dx + (dx*n*strength*0.02))));
      const sy = Math.max(0, Math.min(h-1, Math.round(my + dy + (dy*n*strength*0.02))));
      const si = (sy*w + sx)*4;
      const di = ((my+dy)|0)*w*4 + ((mx+dx)|0)*4;
      if(di>=0 && di<out.data.length){
        out.data[di]=img.data[si]; out.data[di+1]=img.data[si+1]; out.data[di+2]=img.data[si+2]; out.data[di+3]=255;
      }
    }
  }
  gf.clearRect(0,0,w,h);
  gf.putImageData(img,0,0); // base
  gf.putImageData(out,0,0); // refracted lens overlay
  // subtle highlight
  gf.strokeStyle='rgba(255,255,255,0.4)'; gf.beginPath(); gf.arc(mx,my,120,0,6.283); gf.stroke();
}
(function loop(t){
  requestAnimationFrame(loop);
  drawBG(t);
  drawRefraction();
})();
</script></body></html>
