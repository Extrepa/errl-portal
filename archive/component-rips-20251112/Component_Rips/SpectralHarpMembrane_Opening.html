<!doctype html>
<html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Spectral Harp Membrane</title>
<style>
 html,body{height:100%;margin:0;background:#06060c;color:#fff;font-family:ui-sans-serif}
 canvas{position:fixed; inset:0}
 .ui{position:fixed; bottom:1rem; left:50%; transform:translateX(-50%); background:#0006; padding:.4rem .8rem; border:1px solid #fff2; border-radius:10px}
 button{all:unset; background:#fff1; padding:.3rem .6rem; border-radius:8px; cursor:pointer}
</style></head><body>
<canvas id="c"></canvas>
<div class="ui"><button id="mic">Mic</button> <span style="opacity:.8">or just swipe across the grid.</span></div>
<script>
const c=document.getElementById('c'), g=c.getContext('2d'); function fit(){c.width=innerWidth; c.height=innerHeight} fit(); addEventListener('resize',fit);
const cols=40, rows=24;
const pts = Array.from({length:rows}, (_,j)=> Array.from({length:cols}, (_,i)=>({z:0,v:0})) );
let prev={x:0,y:0};
addEventListener('pointermove', e=>{
  const x=e.clientX, y=e.clientY;
  const i=Math.floor(x/innerWidth*cols), j=Math.floor(y/innerHeight*rows);
  const p = pts[j]?.[i]; if(p){ p.v -= 2; }
  prev={x,y};
});
async function enableMic(){
  try{
    const ac = new (window.AudioContext||window.webkitAudioContext)();
    const st = await navigator.mediaDevices.getUserMedia({audio:true});
    const an = ac.createAnalyser(); an.fftSize=256;
    ac.createMediaStreamSource(st).connect(an);
    const data = new Uint8Array(an.frequencyBinCount);
    (function pump(){
      an.getByteFrequencyData(data);
      const bands = 8;
      for(let b=0;b<bands;b++){
        const seg = data.slice(b* (data.length/bands), (b+1)*(data.length/bands));
        const avg = seg.reduce((a,v)=>a+v,0)/seg.length/255;
        const j = Math.floor((rows/bands)*b + (rows/bands)/2);
        for(let i=0;i<cols;i++) pts[j][i].v -= avg*1.5;
      }
      requestAnimationFrame(pump);
    })();
  }catch(e){ alert('Mic permission needed.'); }
}
mic.onclick = enableMic;

function step(){
  for(let j=0;j<rows;j++) for(let i=0;i<cols;i++){
    const p = pts[j][i];
    // membrane spring neighbors
    const n = (pts[j][i-1]?.z||0) + (pts[j][i+1]?.z||0) + (pts[j-1]?.[i]?.z||0) + (pts[j+1]?.[i]?.z||0);
    const k = (n/4 - p.z)*0.2;
    p.v += k; p.v *= 0.98; p.z += p.v;
  }
}
function render(t){
  step();
  g.clearRect(0,0,c.width,c.height);
  const cw=innerWidth/(cols-1), ch=innerHeight/(rows-1);
  for(let j=0;j<rows-1;j++){
    for(let i=0;i<cols-1;i++){
      const a=pts[j][i].z, b=pts[j][i+1].z, c1=pts[j+1][i].z, d=pts[j+1][i+1].z;
      const x=i*cw, y=j*ch;
      const hue = (200 + (a+b+c1+d)*80 + t/20)%360;
      g.fillStyle=`hsla(${hue},100%,55%,0.8)`;
      g.beginPath();
      g.moveTo(x,y+a*4);
      g.lineTo(x+cw,y+b*4);
      g.lineTo(x+cw,y+ch+d*4);
      g.lineTo(x,y+ch+c1*4);
      g.closePath(); g.fill();
    }
  }
  requestAnimationFrame(render);
}
requestAnimationFrame(render);
</script></body></html>
