<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MIDI-Reactive Chromafog</title>
<style>
  html,body{height:100%;margin:0;background:#000;color:#fff;font-family:ui-sans-serif}
  .fog{position:fixed; inset:-20vmax; background:conic-gradient(#ff0066,#ffa400,#ffee00,#46ff6a,#00e5ff,#7b5cff,#ff00c8,#ff0066);
       filter: hue-rotate(var(--hue,0deg)) saturate(1.3) blur(10px);
       opacity: 0.85; animation: roll 30s linear infinite; mix-blend-mode:screen}
  @keyframes roll { to{ transform: rotate(360deg) } }
  .ui{position:fixed; bottom:1rem; left:50%; transform:translateX(-50%); background:#0006; padding:.5rem .8rem; border:1px solid #fff2; border-radius:10px}
  input[type=range]{width:160px}
</style>
</head>
<body>
<div class="fog" id="fog"></div>
<div class="ui">
  <button id="midi">Enable MIDI</button>
  <label style="margin-left:.6rem">Hue <input id="h" type="range" min="0" max="360" value="0"></label>
  <label>Bloom <input id="b" type="range" min="0" max="1" step="0.01" value="0.8"></label>
</div>
<script>
const fog = document.getElementById('fog');
function update(){ document.documentElement.style.setProperty('--hue', h.value+'deg'); fog.style.opacity = (0.4 + parseFloat(b.value)*0.8).toFixed(2); }
h.oninput = b.oninput = update; update();

midi.onclick = async ()=>{
  if(!navigator.requestMIDIAccess){ alert('WebMIDI not supported. Use sliders or keyboard (H/B).'); return; }
  const access = await navigator.requestMIDIAccess();
  for(const input of access.inputs.values()){
    input.onmidimessage = e => {
      const [st, cc, val] = e.data;
      if((st & 0xF0) === 0xB0){ // CC
        if(cc===1){ h.value = (val/127*360)|0; update(); }
        if(cc===2){ b.value = (0.4 + val/127*0.6).toFixed(2); update(); }
      }
    };
  }
};
// keyboard fallback
addEventListener('keydown', e=>{
  if(e.key==='h'){ h.value = (parseInt(h.value)+15)%360; update(); }
  if(e.key==='b'){ b.value = Math.min(1, parseFloat(b.value)+0.05).toFixed(2); update(); }
});
</script>
</body></html>
