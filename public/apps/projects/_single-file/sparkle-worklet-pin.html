<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sparkle Worklet Pin | Errl</title>
<style>
  :root { --reduced-motion: 0; }
  html,body{height:100%;margin:0;background:#0b0b14;color:#fff;font-family:ui-sans-serif}
  .wrap{display:grid; place-items:center; height:100%}
  .pin{width:min(60vmin,420px); aspect-ratio:1/1; border-radius:24px; padding:14px;
       background: radial-gradient(circle at 30% 28%, #1f1f33, #0b0b14 60%);
       position:relative; overflow:hidden}
  .enamel{position:absolute; inset:8% 8%; border-radius:22px; background:paint(sparkle); --twinkle: 0; --seed: 3.14;}
  .face{position:absolute; inset: 20% 20%; border-radius:50%; background: radial-gradient(circle at 40% 40%, #bbf, #77f 60%, #335 100%);
        box-shadow: inset 0 0 40px rgba(255,255,255,.2);}
  .ui{position:fixed; bottom:1rem; left:50%; transform:translateX(-50%);
      background:#0006; padding:.5rem .8rem; border-radius:10px; border:1px solid #fff2}
  input[type=range]{width:220px}
  /* Fallback background if paint() unsupported or blocked */
  .fallback {
    background:
      radial-gradient(12px 12px at 10% 20%, rgba(255,255,255,.45), rgba(255,255,255,0) 60%),
      radial-gradient(10px 10px at 70% 30%, rgba(255,255,255,.35), rgba(255,255,255,0) 60%),
      radial-gradient(8px 8px at 40% 60%, rgba(255,255,255,.25), rgba(255,255,255,0) 60%),
      radial-gradient(16px 16px at 85% 75%, rgba(255,255,255,.30), rgba(255,255,255,0) 60%),
      #121226;
    background-size: auto;
    background-repeat: no-repeat;
  }
  @media (prefers-reduced-motion: no-preference) {
    .fallback { animation: shimmer 8s linear infinite; }
  }
  @media (prefers-reduced-motion: reduce) {
    .fallback { animation: none; }
  }
  @keyframes shimmer {
    0% { background-position: 0% 0%, 40% 0%, 80% 0%, 20% 0%; }
    50% { background-position: 10% 10%, 50% 0%, 75% 30%, 15% 25%; }
    100% { background-position: 0% 0%, 40% 0%, 80% 0%, 20% 0%; }
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="pin">
    <div class="enamel" id="enamel"></div>
    <div class="face"></div>
  </div>
</div>
<div class="ui">
  <label>Twinkle <input id="tw" type="range" min="0" max="10" step="0.01" value="0"></label>
</div>
<script>
(async function(){
  const en = document.getElementById('enamel');
  const tw = document.getElementById('tw');
  const reduce = matchMedia('(prefers-reduced-motion: reduce)');

  function applyFallback(){ en.classList.add('fallback'); }

  let paintOk = false;
  try {
    if ('paintWorklet' in CSS) {
      await CSS.paintWorklet.addModule('./sparkle.js');
      paintOk = true;
    }
  } catch (e) {
    paintOk = false;
  }
  if (!paintOk) applyFallback();

  function tick(t){
    const base = parseFloat(tw.value) || 0;
    const v = reduce.matches ? Math.min(base, 2) : base + t/1000;
    en.style.setProperty('--twinkle', v.toFixed(2));
    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  reduce.addEventListener?.('change', () => {
    if (!paintOk) return; // fallback already static respects MR
  });
})();
</script>
</body>
</html>
